---
title: 只启动一个应用程序实例控制类
date: 2007-11-01 14:20:00
tags: 
categories: 
---
![](https://www.cnblogs.com/images/OutliningIndicators/None.gif)using System;  
![](https://www.cnblogs.com/images/OutliningIndicators/None.gif)using
System.IO;  
![](https://www.cnblogs.com/images/OutliningIndicators/None.gif)using
System.Diagnostics;  
![](https://www.cnblogs.com/images/OutliningIndicators/None.gif)using
System.Threading;  
![](https://www.cnblogs.com/images/OutliningIndicators/None.gif)using
System.Reflection;  
![](https://www.cnblogs.com/images/OutliningIndicators/None.gif)using
System.Runtime.InteropServices;  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedBlockStart.gif)![](https://www.cnblogs.com/images/OutliningIndicators/ContractedBlock.gif)  
![](https://www.cnblogs.com/images/OutliningIndicators/None.gif)namespace
Zhengzuo.CSharpCode  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedBlockStart.gif)![](https://www.cnblogs.com/images/OutliningIndicators/ContractedBlock.gif)![](http://www.cnblogs.com/Images/dot.gif){  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockStart.gif)![](https://www.cnblogs.com/images/OutliningIndicators/ContractedSubBlock.gif)
/**//// <summary>  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)    ///
只启动一个应用程序实例控制类  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockEnd.gif)
/// </summary>  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)    public
static class SingleInstance  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockStart.gif)![](https://www.cnblogs.com/images/OutliningIndicators/ContractedSubBlock.gif)
![](http://www.cnblogs.com/Images/dot.gif){  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
private const int WS_SHOWNORMAL = 1;  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
[DllImport("User32.dll")]  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
private static extern bool ShowWindowAsync(IntPtr hWnd, int cmdShow);  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
[DllImport("User32.dll")]  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
private static extern bool SetForegroundWindow(IntPtr hWnd);  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
//标志文件名称  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
private static string runFlagFullname = null;  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
//声明同步基元  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
private static Mutex mutex = null;  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockStart.gif)![](https://www.cnblogs.com/images/OutliningIndicators/ContractedSubBlock.gif)
/**//// <summary>  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)        ///
static Constructor  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockEnd.gif)
/// </summary>  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
static SingleInstance()  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockStart.gif)![](https://www.cnblogs.com/images/OutliningIndicators/ContractedSubBlock.gif)
![](http://www.cnblogs.com/Images/dot.gif){  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockEnd.gif)
}  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)  
![](https://www.cnblogs.com/images/OutliningIndicators/ContractedSubBlock.gif)![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockStart.gif)
api实现#region api实现  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockStart.gif)![](https://www.cnblogs.com/images/OutliningIndicators/ContractedSubBlock.gif)
/**//// <summary>  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)        ///
获取应用程序进程实例,如果没有匹配进程，返回Null  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)        ///
</summary>  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockEnd.gif)
/// <returns>返回当前Process实例</returns>  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
public static Process GetRunningInstance()  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockStart.gif)![](https://www.cnblogs.com/images/OutliningIndicators/ContractedSubBlock.gif)
![](http://www.cnblogs.com/Images/dot.gif){  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
Process currentProcess = Process.GetCurrentProcess();//获取当前进程  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
//获取当前运行程序完全限定名  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
string currentFileName = currentProcess.MainModule.FileName;  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
//获取进程名为ProcessName的Process数组。  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
Process[] processes = Process.GetProcessesByName(currentProcess.ProcessName);  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
//遍历有相同进程名称正在运行的进程  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
foreach (Process process in processes)  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockStart.gif)![](https://www.cnblogs.com/images/OutliningIndicators/ContractedSubBlock.gif)
![](http://www.cnblogs.com/Images/dot.gif){  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
if (process.MainModule.FileName == currentFileName)  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockStart.gif)![](https://www.cnblogs.com/images/OutliningIndicators/ContractedSubBlock.gif)
![](http://www.cnblogs.com/Images/dot.gif){  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
if (process.Id != currentProcess.Id)//根据进程ID排除当前进程  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
return process;//返回已运行的进程实例  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockEnd.gif)
}  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockEnd.gif)
}  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
return null;  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockEnd.gif)
}  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockStart.gif)![](https://www.cnblogs.com/images/OutliningIndicators/ContractedSubBlock.gif)
/**//// <summary>  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)        ///
获取应用程序句柄，设置应用程序前台运行，并返回bool值  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockEnd.gif)
/// </summary>  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
public static bool HandleRunningInstance(Process instance)  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockStart.gif)![](https://www.cnblogs.com/images/OutliningIndicators/ContractedSubBlock.gif)
![](http://www.cnblogs.com/Images/dot.gif){  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
//确保窗口没有被最小化或最大化  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
ShowWindowAsync(instance.MainWindowHandle, WS_SHOWNORMAL);  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
//设置真实例程为foreground window  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
return SetForegroundWindow(instance.MainWindowHandle);  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockEnd.gif)
}  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockStart.gif)![](https://www.cnblogs.com/images/OutliningIndicators/ContractedSubBlock.gif)
/**//// <summary>  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)        ///
获取窗口句柄，设置应用程序前台运行，并返回bool值，重载方法  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)        ///
</summary>  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockEnd.gif)
/// <returns></returns>  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
public static bool HandleRunningInstance()  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockStart.gif)![](https://www.cnblogs.com/images/OutliningIndicators/ContractedSubBlock.gif)
![](http://www.cnblogs.com/Images/dot.gif){  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
Process p = GetRunningInstance();  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
if (p != null)  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockStart.gif)![](https://www.cnblogs.com/images/OutliningIndicators/ContractedSubBlock.gif)
![](http://www.cnblogs.com/Images/dot.gif){  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
HandleRunningInstance(p);  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
return true;  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockEnd.gif)
}  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
return false;  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockEnd.gif)
}  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockEnd.gif)
#endregion  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)  
![](https://www.cnblogs.com/images/OutliningIndicators/ContractedSubBlock.gif)![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockStart.gif)
Mutex实现#region Mutex实现  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockStart.gif)![](https://www.cnblogs.com/images/OutliningIndicators/ContractedSubBlock.gif)
/**//// <summary>  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)        ///
创建应用程序进程Mutex  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)        ///
</summary>  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockEnd.gif)
/// <returns>返回创建结果，true表示创建成功，false创建失败。</returns>  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
public static bool CreateMutex()  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockStart.gif)![](https://www.cnblogs.com/images/OutliningIndicators/ContractedSubBlock.gif)
![](http://www.cnblogs.com/Images/dot.gif){  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
return CreateMutex(Assembly.GetEntryAssembly().FullName);  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockEnd.gif)
}  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockStart.gif)![](https://www.cnblogs.com/images/OutliningIndicators/ContractedSubBlock.gif)
/**//// <summary>  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)        ///
创建应用程序进程Mutex  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)        ///
</summary>  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)        ///
<param name="name">Mutex名称</param>  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockEnd.gif)
/// <returns>返回创建结果，true表示创建成功，false创建失败。</returns>  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
public static bool CreateMutex(string name)  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockStart.gif)![](https://www.cnblogs.com/images/OutliningIndicators/ContractedSubBlock.gif)
![](http://www.cnblogs.com/Images/dot.gif){  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
bool result = false;  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
mutex = new Mutex(true, name, out result);  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
return result;  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockEnd.gif)
}  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockStart.gif)![](https://www.cnblogs.com/images/OutliningIndicators/ContractedSubBlock.gif)
/**//// <summary>  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)        ///
释放Mutex  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockEnd.gif)
/// </summary>  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
public static void ReleaseMutex()  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockStart.gif)![](https://www.cnblogs.com/images/OutliningIndicators/ContractedSubBlock.gif)
![](http://www.cnblogs.com/Images/dot.gif){  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
if (mutex != null)  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockStart.gif)![](https://www.cnblogs.com/images/OutliningIndicators/ContractedSubBlock.gif)
![](http://www.cnblogs.com/Images/dot.gif){  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
mutex.Close();  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockEnd.gif)
}  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockEnd.gif)
}  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockEnd.gif)
#endregion  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)  
![](https://www.cnblogs.com/images/OutliningIndicators/ContractedSubBlock.gif)![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockStart.gif)
设置标志实现#region 设置标志实现  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockStart.gif)![](https://www.cnblogs.com/images/OutliningIndicators/ContractedSubBlock.gif)
/**//// <summary>  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)        ///
初始化程序运行标志，如果设置成功，返回true，已经设置返回false，设置失败将抛出异常  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)        ///
</summary>  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockEnd.gif)
/// <returns>返回设置结果</returns>  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
public static bool InitRunFlag()  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockStart.gif)![](https://www.cnblogs.com/images/OutliningIndicators/ContractedSubBlock.gif)
![](http://www.cnblogs.com/Images/dot.gif){  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
if (File.Exists(RunFlag))  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockStart.gif)![](https://www.cnblogs.com/images/OutliningIndicators/ContractedSubBlock.gif)
![](http://www.cnblogs.com/Images/dot.gif){  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
return false;  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockEnd.gif)
}  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
using (FileStream fs = new FileStream(RunFlag, FileMode.Create))  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockStart.gif)![](https://www.cnblogs.com/images/OutliningIndicators/ContractedSubBlock.gif)
![](http://www.cnblogs.com/Images/dot.gif){  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockEnd.gif)
}  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
return true;  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockEnd.gif)
}  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockStart.gif)![](https://www.cnblogs.com/images/OutliningIndicators/ContractedSubBlock.gif)
/**//// <summary>  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)        ///
释放初始化程序运行标志，如果释放失败将抛出异常  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockEnd.gif)
/// </summary>  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
public static void DisposeRunFlag()  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockStart.gif)![](https://www.cnblogs.com/images/OutliningIndicators/ContractedSubBlock.gif)
![](http://www.cnblogs.com/Images/dot.gif){  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
if (File.Exists(RunFlag))  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockStart.gif)![](https://www.cnblogs.com/images/OutliningIndicators/ContractedSubBlock.gif)
![](http://www.cnblogs.com/Images/dot.gif){  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
File.Delete(RunFlag);  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockEnd.gif)
}  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockEnd.gif)
}  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockStart.gif)![](https://www.cnblogs.com/images/OutliningIndicators/ContractedSubBlock.gif)
/**//// <summary>  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)        ///
获取或设置程序运行标志，必须符合Windows文件命名规范  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)        ///
这里实现生成临时文件为依据，如果修改成设置注册表，那就不需要符合文件命名规范。  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockEnd.gif)
/// </summary>  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
public static string RunFlag  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockStart.gif)![](https://www.cnblogs.com/images/OutliningIndicators/ContractedSubBlock.gif)
![](http://www.cnblogs.com/Images/dot.gif){  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
get  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockStart.gif)![](https://www.cnblogs.com/images/OutliningIndicators/ContractedSubBlock.gif)
![](http://www.cnblogs.com/Images/dot.gif){  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
if (runFlagFullname == null)  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockStart.gif)![](https://www.cnblogs.com/images/OutliningIndicators/ContractedSubBlock.gif)
![](http://www.cnblogs.com/Images/dot.gif){  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
string assemblyFullName = Assembly.GetEntryAssembly().FullName;  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
//CommonApplicationData：//"C:\\\Documents and Settings\\\All
Users\\\Application Data"  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
string path =
Environment.GetFolderPath(Environment.SpecialFolder.CommonApplicationData);  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
//"C:\\\Program Files\\\Common Files"  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
//string path =
Environment.GetFolderPath(Environment.SpecialFolder.CommonProgramFiles);  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
runFlagFullname = Path.Combine(path, assemblyFullName);  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockEnd.gif)
}  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
return runFlagFullname;  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockEnd.gif)
}  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
set  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockStart.gif)![](https://www.cnblogs.com/images/OutliningIndicators/ContractedSubBlock.gif)
![](http://www.cnblogs.com/Images/dot.gif){  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
runFlagFullname = value;  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockEnd.gif)
}  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockEnd.gif)
}  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockEnd.gif)
#endregion  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockEnd.gif)
}  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedBlockEnd.gif)}

---
title: 只启动一个应用程序实例控制类
date: 2007-11-01 14:20:00
tags: 
categories: 
---
![](https://www.cnblogs.com/images/OutliningIndicators/None.gif)using System;  
![](https://www.cnblogs.com/images/OutliningIndicators/None.gif)using
System.IO;  
![](https://www.cnblogs.com/images/OutliningIndicators/None.gif)using
System.Diagnostics;  
![](https://www.cnblogs.com/images/OutliningIndicators/None.gif)using
System.Threading;  
![](https://www.cnblogs.com/images/OutliningIndicators/None.gif)using
System.Reflection;  
![](https://www.cnblogs.com/images/OutliningIndicators/None.gif)using
System.Runtime.InteropServices;  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedBlockStart.gif)![](https://www.cnblogs.com/images/OutliningIndicators/ContractedBlock.gif)  
![](https://www.cnblogs.com/images/OutliningIndicators/None.gif)namespace
Zhengzuo.CSharpCode  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedBlockStart.gif)![](https://www.cnblogs.com/images/OutliningIndicators/ContractedBlock.gif)![](http://www.cnblogs.com/Images/dot.gif){  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockStart.gif)![](https://www.cnblogs.com/images/OutliningIndicators/ContractedSubBlock.gif)
/**//// <summary>  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)    ///
只启动一个应用程序实例控制类  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockEnd.gif)
/// </summary>  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)    public
static class SingleInstance  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockStart.gif)![](https://www.cnblogs.com/images/OutliningIndicators/ContractedSubBlock.gif)
![](http://www.cnblogs.com/Images/dot.gif){  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
private const int WS_SHOWNORMAL = 1;  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
[DllImport("User32.dll")]  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
private static extern bool ShowWindowAsync(IntPtr hWnd, int cmdShow);  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
[DllImport("User32.dll")]  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
private static extern bool SetForegroundWindow(IntPtr hWnd);  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
//标志文件名称  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
private static string runFlagFullname = null;  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
//声明同步基元  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
private static Mutex mutex = null;  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockStart.gif)![](https://www.cnblogs.com/images/OutliningIndicators/ContractedSubBlock.gif)
/**//// <summary>  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)        ///
static Constructor  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockEnd.gif)
/// </summary>  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
static SingleInstance()  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockStart.gif)![](https://www.cnblogs.com/images/OutliningIndicators/ContractedSubBlock.gif)
![](http://www.cnblogs.com/Images/dot.gif){  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockEnd.gif)
}  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)  
![](https://www.cnblogs.com/images/OutliningIndicators/ContractedSubBlock.gif)![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockStart.gif)
api实现#region api实现  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockStart.gif)![](https://www.cnblogs.com/images/OutliningIndicators/ContractedSubBlock.gif)
/**//// <summary>  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)        ///
获取应用程序进程实例,如果没有匹配进程，返回Null  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)        ///
</summary>  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockEnd.gif)
/// <returns>返回当前Process实例</returns>  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
public static Process GetRunningInstance()  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockStart.gif)![](https://www.cnblogs.com/images/OutliningIndicators/ContractedSubBlock.gif)
![](http://www.cnblogs.com/Images/dot.gif){  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
Process currentProcess = Process.GetCurrentProcess();//获取当前进程  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
//获取当前运行程序完全限定名  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
string currentFileName = currentProcess.MainModule.FileName;  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
//获取进程名为ProcessName的Process数组。  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
Process[] processes = Process.GetProcessesByName(currentProcess.ProcessName);  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
//遍历有相同进程名称正在运行的进程  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
foreach (Process process in processes)  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockStart.gif)![](https://www.cnblogs.com/images/OutliningIndicators/ContractedSubBlock.gif)
![](http://www.cnblogs.com/Images/dot.gif){  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
if (process.MainModule.FileName == currentFileName)  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockStart.gif)![](https://www.cnblogs.com/images/OutliningIndicators/ContractedSubBlock.gif)
![](http://www.cnblogs.com/Images/dot.gif){  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
if (process.Id != currentProcess.Id)//根据进程ID排除当前进程  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
return process;//返回已运行的进程实例  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockEnd.gif)
}  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockEnd.gif)
}  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
return null;  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockEnd.gif)
}  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockStart.gif)![](https://www.cnblogs.com/images/OutliningIndicators/ContractedSubBlock.gif)
/**//// <summary>  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)        ///
获取应用程序句柄，设置应用程序前台运行，并返回bool值  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockEnd.gif)
/// </summary>  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
public static bool HandleRunningInstance(Process instance)  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockStart.gif)![](https://www.cnblogs.com/images/OutliningIndicators/ContractedSubBlock.gif)
![](http://www.cnblogs.com/Images/dot.gif){  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
//确保窗口没有被最小化或最大化  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
ShowWindowAsync(instance.MainWindowHandle, WS_SHOWNORMAL);  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
//设置真实例程为foreground window  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
return SetForegroundWindow(instance.MainWindowHandle);  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockEnd.gif)
}  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockStart.gif)![](https://www.cnblogs.com/images/OutliningIndicators/ContractedSubBlock.gif)
/**//// <summary>  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)        ///
获取窗口句柄，设置应用程序前台运行，并返回bool值，重载方法  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)        ///
</summary>  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockEnd.gif)
/// <returns></returns>  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
public static bool HandleRunningInstance()  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockStart.gif)![](https://www.cnblogs.com/images/OutliningIndicators/ContractedSubBlock.gif)
![](http://www.cnblogs.com/Images/dot.gif){  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
Process p = GetRunningInstance();  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
if (p != null)  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockStart.gif)![](https://www.cnblogs.com/images/OutliningIndicators/ContractedSubBlock.gif)
![](http://www.cnblogs.com/Images/dot.gif){  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
HandleRunningInstance(p);  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
return true;  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockEnd.gif)
}  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
return false;  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockEnd.gif)
}  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockEnd.gif)
#endregion  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)  
![](https://www.cnblogs.com/images/OutliningIndicators/ContractedSubBlock.gif)![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockStart.gif)
Mutex实现#region Mutex实现  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockStart.gif)![](https://www.cnblogs.com/images/OutliningIndicators/ContractedSubBlock.gif)
/**//// <summary>  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)        ///
创建应用程序进程Mutex  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)        ///
</summary>  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockEnd.gif)
/// <returns>返回创建结果，true表示创建成功，false创建失败。</returns>  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
public static bool CreateMutex()  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockStart.gif)![](https://www.cnblogs.com/images/OutliningIndicators/ContractedSubBlock.gif)
![](http://www.cnblogs.com/Images/dot.gif){  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
return CreateMutex(Assembly.GetEntryAssembly().FullName);  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockEnd.gif)
}  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockStart.gif)![](https://www.cnblogs.com/images/OutliningIndicators/ContractedSubBlock.gif)
/**//// <summary>  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)        ///
创建应用程序进程Mutex  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)        ///
</summary>  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)        ///
<param name="name">Mutex名称</param>  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockEnd.gif)
/// <returns>返回创建结果，true表示创建成功，false创建失败。</returns>  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
public static bool CreateMutex(string name)  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockStart.gif)![](https://www.cnblogs.com/images/OutliningIndicators/ContractedSubBlock.gif)
![](http://www.cnblogs.com/Images/dot.gif){  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
bool result = false;  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
mutex = new Mutex(true, name, out result);  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
return result;  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockEnd.gif)
}  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockStart.gif)![](https://www.cnblogs.com/images/OutliningIndicators/ContractedSubBlock.gif)
/**//// <summary>  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)        ///
释放Mutex  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockEnd.gif)
/// </summary>  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
public static void ReleaseMutex()  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockStart.gif)![](https://www.cnblogs.com/images/OutliningIndicators/ContractedSubBlock.gif)
![](http://www.cnblogs.com/Images/dot.gif){  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
if (mutex != null)  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockStart.gif)![](https://www.cnblogs.com/images/OutliningIndicators/ContractedSubBlock.gif)
![](http://www.cnblogs.com/Images/dot.gif){  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
mutex.Close();  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockEnd.gif)
}  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockEnd.gif)
}  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockEnd.gif)
#endregion  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)  
![](https://www.cnblogs.com/images/OutliningIndicators/ContractedSubBlock.gif)![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockStart.gif)
设置标志实现#region 设置标志实现  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockStart.gif)![](https://www.cnblogs.com/images/OutliningIndicators/ContractedSubBlock.gif)
/**//// <summary>  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)        ///
初始化程序运行标志，如果设置成功，返回true，已经设置返回false，设置失败将抛出异常  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)        ///
</summary>  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockEnd.gif)
/// <returns>返回设置结果</returns>  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
public static bool InitRunFlag()  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockStart.gif)![](https://www.cnblogs.com/images/OutliningIndicators/ContractedSubBlock.gif)
![](http://www.cnblogs.com/Images/dot.gif){  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
if (File.Exists(RunFlag))  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockStart.gif)![](https://www.cnblogs.com/images/OutliningIndicators/ContractedSubBlock.gif)
![](http://www.cnblogs.com/Images/dot.gif){  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
return false;  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockEnd.gif)
}  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
using (FileStream fs = new FileStream(RunFlag, FileMode.Create))  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockStart.gif)![](https://www.cnblogs.com/images/OutliningIndicators/ContractedSubBlock.gif)
![](http://www.cnblogs.com/Images/dot.gif){  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockEnd.gif)
}  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
return true;  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockEnd.gif)
}  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockStart.gif)![](https://www.cnblogs.com/images/OutliningIndicators/ContractedSubBlock.gif)
/**//// <summary>  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)        ///
释放初始化程序运行标志，如果释放失败将抛出异常  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockEnd.gif)
/// </summary>  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
public static void DisposeRunFlag()  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockStart.gif)![](https://www.cnblogs.com/images/OutliningIndicators/ContractedSubBlock.gif)
![](http://www.cnblogs.com/Images/dot.gif){  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
if (File.Exists(RunFlag))  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockStart.gif)![](https://www.cnblogs.com/images/OutliningIndicators/ContractedSubBlock.gif)
![](http://www.cnblogs.com/Images/dot.gif){  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
File.Delete(RunFlag);  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockEnd.gif)
}  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockEnd.gif)
}  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockStart.gif)![](https://www.cnblogs.com/images/OutliningIndicators/ContractedSubBlock.gif)
/**//// <summary>  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)        ///
获取或设置程序运行标志，必须符合Windows文件命名规范  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)        ///
这里实现生成临时文件为依据，如果修改成设置注册表，那就不需要符合文件命名规范。  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockEnd.gif)
/// </summary>  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
public static string RunFlag  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockStart.gif)![](https://www.cnblogs.com/images/OutliningIndicators/ContractedSubBlock.gif)
![](http://www.cnblogs.com/Images/dot.gif){  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
get  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockStart.gif)![](https://www.cnblogs.com/images/OutliningIndicators/ContractedSubBlock.gif)
![](http://www.cnblogs.com/Images/dot.gif){  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
if (runFlagFullname == null)  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockStart.gif)![](https://www.cnblogs.com/images/OutliningIndicators/ContractedSubBlock.gif)
![](http://www.cnblogs.com/Images/dot.gif){  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
string assemblyFullName = Assembly.GetEntryAssembly().FullName;  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
//CommonApplicationData：//"C:\\\Documents and Settings\\\All
Users\\\Application Data"  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
string path =
Environment.GetFolderPath(Environment.SpecialFolder.CommonApplicationData);  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
//"C:\\\Program Files\\\Common Files"  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
//string path =
Environment.GetFolderPath(Environment.SpecialFolder.CommonProgramFiles);  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
runFlagFullname = Path.Combine(path, assemblyFullName);  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockEnd.gif)
}  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
return runFlagFullname;  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockEnd.gif)
}  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
set  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockStart.gif)![](https://www.cnblogs.com/images/OutliningIndicators/ContractedSubBlock.gif)
![](http://www.cnblogs.com/Images/dot.gif){  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)
runFlagFullname = value;  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockEnd.gif)
}  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockEnd.gif)
}  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockEnd.gif)
#endregion  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedSubBlockEnd.gif)
}  
![](https://www.cnblogs.com/images/OutliningIndicators/InBlock.gif)  
![](https://www.cnblogs.com/images/OutliningIndicators/ExpandedBlockEnd.gif)}

